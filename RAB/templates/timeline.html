{% extends "base.html" %}
{% block head %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/timeline.css') }}">
<style>
    #timeline-map {
        width: 100%;
        height: 50vh; /* Set the map height to 50% of the viewport height */
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<h2>Photo Timeline</h2>
<div id="timeline-container">
    <div id="timeline-slider">
        <input type="range" id="timeline-range">
        <div id="timeline-output"></div>
    </div>
    <div id="timeline-map"></div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Ensure correct base URLs from environment paths
var uploadsUrl = "{{ uploads_url }}";
if (!uploadsUrl.endsWith('/')) {
    uploadsUrl += '/';
}
var previewsUrl = "{{ previews_url }}";
if (!previewsUrl.endsWith('/')) {
    previewsUrl += '/';
}
</script>

<!-- Load custom timeline script with data attribute for photos URL -->
<script src="{{ url_for('static', filename='js/timeline.js') }}" data-timeline-photos-url="{{ timeline_photos_url }}"></script>

<script>
// Initialize the map with proper attribution and prevent reinitialization

var uploadsUrl = "{{ uploads_url }}";
if (!uploadsUrl.endsWith('/')) {
    uploadsUrl += '/';
}
var previewsUrl = "{{ previews_url }}";
if (!previewsUrl.endsWith('/')) {
    previewsUrl += '/';
}

</script>
{% endblock %}
